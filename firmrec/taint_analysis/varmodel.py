"""
This module contains models of typical variables without linking
"""
import binascii


class VarModel(object):
    """
    Abstract class for variable models
    """
    def __init__(self):
        pass

    def match(self, state, addr, name):
        """
        Match a variable to the model
        :param var: The variable to match
        :return: True if the variable matches the model
        """
        return False


class ArrayPtrVarModel(VarModel):
    """
    Model for array variables
    """
    def __init__(self, var_name, content: bytes):
        super().__init__()
        self.var_name = var_name
        self.content = content
        self._matched_ptrs = {}

    def match(self, state, name, addr: int, arr_ptr: int):
        """
        Match a variable to the model
        :param var: The variable to match
        :return: True if the variable matches the model
        """
        if name != self.var_name:
            return None
        if arr_ptr in self._matched_ptrs:
            return None
        size = len(self.content)
        ptr = state.heap.allocate(size)
        state.memory.store(ptr, self.content)
        return ptr


VAR_MODELS = [
    ArrayPtrVarModel("__ctype_b", binascii.unhexlify('000200020002000200020002000200020002200320022002200220020002000200020002000200020002000200020002000200020002000200020002000200026001c004c004c004c004c004c004c004c004c004c004c004c004c004c004c004d808d808d808d808d808d808d808d808d808d808c004c004c004c004c004c004c004d508d508d508d508d508d508c508c508c508c508c508c508c508c508c508c508c508c508c508c508c508c508c508c508c508c508c004c004c004c004c004c004d608d608d608d608d608d608c608c608c608c608c608c608c608c608c608c608c608c608c608c608c608c608c608c608c608c608c004c004c004c0040002')),
    ArrayPtrVarModel("__ctype_tolower", binascii.unhexlify('00000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f0020002100220023002400250026002700280029002a002b002c002d002e002f0030003100320033003400350036003700380039003a003b003c003d003e003f0040006100620063006400650066006700680069006a006b006c006d006e006f0070007100720073007400750076007700780079007a005b005c005d005e005f0060006100620063006400650066006700680069006a006b006c006d006e006f0070007100720073007400750076007700780079007a007b007c007d007e007f0080008100820083008400850086008700880089008a008b008c008d008e008f0090009100920093009400950096009700980099009a009b009c009d009e009f00a000a100a200a300a400a500a600a700a800a900aa00ab00ac00ad00ae00af00b000b100b200b300b400b500b600b700b800b900ba00bb00bc00bd00be00bf00c000c100c200c300c400c500c600c700c800c900ca00cb00cc00cd00ce00cf00d000d100d200d300d400d500d600d700d800d900da00db00dc00dd00de00df00e000e100e200e300e400e500e600e700e800e900ea00eb00ec00ed00ee00ef00f000f100f200f300f400f500f600f700f800f900fa00fb00fc00fd00fe00ff00')),
    ArrayPtrVarModel("__ctype_toupper", binascii.unhexlify('00000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f0020002100220023002400250026002700280029002a002b002c002d002e002f0030003100320033003400350036003700380039003a003b003c003d003e003f0040004100420043004400450046004700480049004a004b004c004d004e004f0050005100520053005400550056005700580059005a005b005c005d005e005f0060004100420043004400450046004700480049004a004b004c004d004e004f0050005100520053005400550056005700580059005a007b007c007d007e007f0080008100820083008400850086008700880089008a008b008c008d008e008f0090009100920093009400950096009700980099009a009b009c009d009e009f00a000a100a200a300a400a500a600a700a800a900aa00ab00ac00ad00ae00af00b000b100b200b300b400b500b600b700b800b900ba00bb00bc00bd00be00bf00c000c100c200c300c400c500c600c700c800c900ca00cb00cc00cd00ce00cf00d000d100d200d300d400d500d600d700d800d900da00db00dc00dd00de00df00e000e100e200e300e400e500e600e700e800e900ea00eb00ec00ed00ee00ef00f000f100f200f300f400f500f600f700f800f900fa00fb00fc00fd00fe00ff00'))
]